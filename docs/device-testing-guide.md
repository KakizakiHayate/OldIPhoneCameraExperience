# 実機テストガイド

このドキュメントは、OldIPhoneCameraExperience アプリの実機テストを行うための手順とチェックリストです。

## 前提条件

- Xcode 15.0 以降
- iOS 17.0 以降を搭載した実機（iPhone）
- Apple Developer アカウント（無料アカウントでも可）
- USB-Cケーブル（実機接続用）

## セットアップ手順

### 1. プロジェクトを開く

```bash
cd OldIPhoneCameraExperience
open OldIPhoneCameraExperience.xcodeproj
```

### 2. 署名設定

1. Xcodeでプロジェクトを開く
2. プロジェクトナビゲーターで `OldIPhoneCameraExperience` プロジェクトを選択
3. `Signing & Capabilities` タブを開く
4. `Team` で自分のApple Developer アカウントを選択
5. `Bundle Identifier` を一意のものに変更（例: `com.yourname.OldIPhoneCameraExperience`）

### 3. 実機接続

1. iPhoneをUSB-Cケーブルでコンピュータに接続
2. iPhone側で「このコンピュータを信頼しますか？」と表示されたら「信頼」をタップ
3. Xcodeの上部バーで、接続したiPhoneを選択

### 4. ビルド & 実行

1. Xcodeで `Cmd + R` を押すか、再生ボタンをクリック
2. ビルドが成功したら、アプリが自動的に起動

## テストチェックリスト

### Phase 1: 基本機能テスト

#### カメラ起動
- [ ] アプリ起動時にカメラ権限のダイアログが表示される
- [ ] 「許可」をタップ後、カメラプレビューが表示される
- [ ] プレビューが4:3のアスペクト比で表示される
- [ ] プレビューがリアルタイムで更新される

#### 撮影機能
- [ ] シャッターボタンをタップすると撮影できる
- [ ] 撮影時に虹彩絞りアニメーションが表示される
- [ ] 撮影後にフォトライブラリ保存の権限ダイアログが表示される（初回のみ）
- [ ] 「許可」をタップ後、写真がカメラロールに保存される
- [ ] 保存された写真を「写真」アプリで確認できる

#### フラッシュ機能
- [ ] フラッシュボタンをタップするとオン/オフが切り替わる
- [ ] フラッシュオン時、ボタンの見た目が変わる（isActive状態）
- [ ] フラッシュオン時、暗い場所で撮影するとフラッシュが発光する

#### カメラ切り替え
- [ ] カメラ切り替えボタンをタップすると前面/背面が切り替わる
- [ ] 切り替え時にプレビューが更新される
- [ ] 前面カメラでも撮影できる

### Phase 2: フィルター効果テスト

#### 暖色系フィルター
- [ ] 撮影した写真が暖色系（オレンジ〜黄色がかった色味）になっている
- [ ] 色温度が+2500K程度上がっている（視覚的に確認）
- [ ] 彩度が1.2倍程度上がっている（視覚的に確認）

#### 画角クロップ
- [ ] 撮影した写真が中央80%にクロップされている
- [ ] クロップ後も画質が保たれている

### Phase 3: 手ブレシミュレーションテスト

#### モーションデータ取得
- [ ] アプリ起動時にモーション権限のダイアログが表示される（iOS 13以降）
- [ ] 「許可」をタップ後、モーションデータが取得される

#### 手ブレ効果
- [ ] 撮影時にiPhoneを軽く揺らすと、写真に手ブレ効果が適用される
- [ ] 手ブレ効果として以下が確認できる:
  - [ ] わずかなシフト（平行移動）
  - [ ] わずかな回転
  - [ ] モーションブラー

### Phase 4: UI/UXテスト

#### スキューモーフィズムUI
- [ ] シャッターボタンが立体的に見える（影、グラデーション）
- [ ] ツールバーボタンが金属質感のグラデーションになっている
- [ ] サムネイルが角丸で枠線がある

#### 虹彩絞りアニメーション
- [ ] 撮影時に黒い円が中心に向かって縮む（閉じる）
- [ ] その後、黒い円が中心から広がって消える（開く）
- [ ] アニメーションの時間が適切（閉じる: 0.15秒、開く: 0.2秒）

#### ステータスバー
- [ ] ステータスバーが非表示になっている（レトロUI没入体験）

### Phase 5: パフォーマンステスト

#### フレームレート
- [ ] カメラプレビューが滑らかに表示される（30fps以上）
- [ ] UIの操作が滑らかに動作する

#### 撮影速度
- [ ] シャッターボタンをタップしてから撮影完了まで1秒以内
- [ ] 連続撮影しても遅延が発生しない

#### メモリ使用量
- [ ] アプリがクラッシュしない
- [ ] 長時間使用してもメモリリークが発生しない

### Phase 6: エッジケーステスト

#### 権限拒否
- [ ] カメラ権限を拒否した場合、適切なエラーメッセージが表示される
- [ ] フォトライブラリ権限を拒否した場合、適切なエラーメッセージが表示される

#### バックグラウンド移行
- [ ] アプリをバックグラウンドに移行してもクラッシュしない
- [ ] フォアグラウンドに戻るとカメラが再開される

#### 低照度環境
- [ ] 暗い場所でもプレビューが表示される
- [ ] 暗い場所でも撮影できる

## チューニング項目

実機テストで以下のパラメータを調整する必要がある場合は、`OldIPhoneCameraExperience/Core/Constants/FilterParameters.swift` を編集してください。

### フィルターパラメータ

```swift
struct FilterParameters {
    static let warmthTemperature: CGFloat = 2500.0  // 色温度（調整範囲: 1000〜5000）
    static let warmthTint: CGFloat = 0.0            // 色合い（調整範囲: -100〜100）
    static let saturation: CGFloat = 1.2            // 彩度（調整範囲: 1.0〜1.5）
    static let contrast: CGFloat = 1.1              // コントラスト（調整範囲: 1.0〜1.3）
    static let cropScale: CGFloat = 0.8             // クロップ倍率（調整範囲: 0.7〜0.9）
}
```

### 手ブレパラメータ

```swift
// ShakeEffect.swift の generate(from:) メソッド内
let shiftX = rotationRate.x * 5.0  // シフト量（調整範囲: 3.0〜10.0）
let shiftY = rotationRate.y * 5.0
let rotation = rotationRate.z * 2.0  // 回転量（調整範囲: 1.0〜5.0）
let motionBlurRadius = abs(rotationRate.x + rotationRate.y) * 3.0  // ブラー半径（調整範囲: 2.0〜5.0）
```

## トラブルシューティング

### ビルドエラー

**エラー:** `Signing for "OldIPhoneCameraExperience" requires a development team.`

**解決策:** Xcode の `Signing & Capabilities` で Team を選択してください。

---

**エラー:** `No such module 'OldIPhoneCameraExperience'`

**解決策:** プロジェクトをクリーンビルドしてください（`Cmd + Shift + K`）。

### 実行時エラー

**エラー:** カメラプレビューが真っ黒

**解決策:** Info.plist に `NSCameraUsageDescription` が設定されているか確認してください。

---

**エラー:** 写真が保存されない

**解決策:** Info.plist に `NSPhotoLibraryAddUsageDescription` が設定されているか確認してください。

## 次のステップ

実機テストが完了したら、以下のステップに進んでください:

1. `docs/progress.md` を更新し、Issue #12 を完了としてマークする
2. App Store提出用のスクリーンショットを撮影する（`docs/appstore-metadata.md` 参照）
3. `fastlane` を使ってApp Store Connect にアップロードする
